generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ==========================================
// VEHICLE AGGREGATE
// ==========================================

model Vehicle {
  id             String   @id @default(uuid())
  ownerId        String   @map("owner_id")
  brand          String
  model          String
  year           Int
  licensePlate   String   @unique @map("license_plate")
  vin            String?  @unique
  currentMileage Int      @default(0) @map("current_mileage")
  photoUrl       String?  @map("photo_url")
  
  // Relations
  maintenanceHistory MaintenanceHistory[]
  reminders          ServiceReminder[]
  
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@index([ownerId])
  @@map("vehicles")
}

// ==========================================
// MAINTENANCE HISTORY
// ==========================================

model MaintenanceHistory {
  id               String   @id @default(uuid())
  vehicleId        String   @map("vehicle_id")
  serviceType      String   @map("service_type")
  description      String?
  serviceDate      DateTime @map("service_date")
  mileageAtService Int      @map("mileage_at_service")
  cost             Float?
  currency         String   @default("MXN")
  workshopName     String?  @map("workshop_name")
  invoiceUrl       String?  @map("invoice_url")
  notes            String?
  
  // Relations
  vehicle Vehicle @relation(fields: [vehicleId], references: [id], onDelete: Cascade)
  
  createdAt DateTime @default(now()) @map("created_at")

  @@index([vehicleId])
  @@index([serviceDate])
  @@map("maintenance_history")
}

// ==========================================
// SERVICE REMINDERS
// ==========================================

model ServiceReminder {
  id             String    @id @default(uuid())
  vehicleId      String    @map("vehicle_id")
  serviceType    String    @map("service_type")
  description    String?
  dueType        String    @map("due_type")
  dueValue       String    @map("due_value")
  status         String    @default("PENDING")
  postponedUntil DateTime? @map("postponed_until")
  
  // Relations
  vehicle Vehicle @relation(fields: [vehicleId], references: [id], onDelete: Cascade)
  
  createdAt DateTime @default(now()) @map("created_at")

  @@index([vehicleId])
  @@index([status])
  @@map("service_reminders")
}
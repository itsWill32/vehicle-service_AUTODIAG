// This is your Prisma schema file for Vehicle Service
// Learn more: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ============================================
// VEHICLE SERVICE MODELS
// ============================================

model Vehicle {
  id          String   @id @default(uuid())
  userId      String   // Foreign key to Auth Service
  
  // Basic info
  make        String   // Marca (Toyota, Honda, etc.)
  model       String   // Modelo (Corolla, Civic, etc.)
  year        Int
  plate       String   @unique
  vin         String?  @unique // Vehicle Identification Number
  color       String?
  
  // Specs
  engineType  String?  // Gasolina, Diesel, Eléctrico, Híbrido
  transmission String? // Manual, Automático
  mileage     Int?     // Kilometraje actual
  
  // Insurance & Docs
  insuranceCompany String?
  insurancePolicy  String?
  insuranceExpiry  DateTime?
  
  // Photo
  photo       String?
  
  // Status
  isActive    Boolean  @default(true)
  
  // Relationships
  maintenanceRecords MaintenanceRecord[]
  reminders          ServiceReminder[]
  
  // Timestamps
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([userId])
  @@index([plate])
  @@index([vin])
  @@map("vehicles")
}

// ============================================
// MAINTENANCE RECORDS
// ============================================

model MaintenanceRecord {
  id          String   @id @default(uuid())
  vehicleId   String
  vehicle     Vehicle  @relation(fields: [vehicleId], references: [id], onDelete: Cascade)
  
  // Service details
  serviceType String   // Cambio de aceite, Revisión, Reparación, etc.
  description String
  workshopId  String?  // Foreign key to Workshop Service
  workshopName String?
  
  // Costs
  laborCost   Float    @default(0)
  partsCost   Float    @default(0)
  totalCost   Float
  
  // Mileage at service
  mileageAt   Int?
  
  // Date
  serviceDate DateTime
  
  // Notes
  notes       String?
  
  // Attachments
  invoiceUrl  String?
  photos      String[] // Array of photo URLs
  
  // Timestamps
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([vehicleId])
  @@index([serviceDate])
  @@map("maintenance_records")
}

// ============================================
// SERVICE REMINDERS
// ============================================

model ServiceReminder {
  id          String   @id @default(uuid())
  vehicleId   String
  vehicle     Vehicle  @relation(fields: [vehicleId], references: [id], onDelete: Cascade)
  
  // Reminder details
  serviceType String   // Tipo de servicio a recordar
  description String?
  
  // Trigger conditions (al menos uno debe estar definido)
  reminderMileage Int?    // Recordar al llegar a X km
  reminderDate    DateTime? // Recordar en fecha específica
  
  // Status
  isCompleted Boolean  @default(false)
  completedAt DateTime?
  
  // Notification
  lastNotified DateTime?
  
  // Timestamps
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([vehicleId])
  @@index([reminderDate])
  @@index([isCompleted])
  @@map("service_reminders")
}
